<script>
const obj = {
    a: 1,
    b: 2,
}

const cbs = new Map();

let usedReactivities = [];

const po = reactive(obj);

effect(() => {
    console.log(po.a)
})

function effect(cb) {
    usedReactivities = [];
    cb();
    console.log(usedReactivities);

    for (let reactivity of usedReactivities) {
        if (!cbs.has(reactivity[0])) {
            cbs.set(reactivity[0], new Map())
        }
        if (!cbs.get(reactivity[0]).has(reactivity[1])) {
            cbs.get(reactivity[0]).set(reactivity[1], []);
        }
        cbs.get(reactivity[0]).get(reactivity[1]).push(cb);
    }
}

function reactive(obj) {
    return new Proxy(obj, {
        set(obj, prop, val) {
            obj[prop] = val;
            if (cbs.has(obj) && cbs.get(obj).has(prop)) {
                for (let cb of cbs.get(obj).get(prop)) {
                    cb();
                }
            }
            return obj;
        },

        get(obj, prop) {
            usedReactivities.push([obj, prop])
            return obj[prop];
        }
    })

}



</script>
